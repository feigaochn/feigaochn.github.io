<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>feigao.me - note</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">feigao.me </a></h1>
                <nav><ul>
                    <li><a href="/pages/about-me.html">about me</a></li>
                    <li><a href="/category/posts.html">posts</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/reading-notes-on-code-like-a-pythonista.html">Reading Notes on Code Like a Pythonista</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-06-03T00:00:00+08:00">
                Published: Tue 03 June 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/fei-gao.html">Fei Gao</a>
        </address>
<p>In <a href="/category/posts.html">posts</a>. </p>
<p>tags: <a href="/tag/python.html">python</a> <a href="/tag/note.html">note</a> </p>
</footer><!-- /.post-info --><h2>Original post</h2>
<p><a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html">Code Like a Pythonista: Idiomatic Python</a> by <a href="http://python.net/~goodger">David Goodger</a>.</p>
<h2>Zen of Python</h2>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">this</span>

<span class="n">The</span> <span class="n">Zen</span> <span class="n">of</span> <span class="n">Python</span><span class="p">,</span> <span class="n">by</span> <span class="n">Tim</span> <span class="n">Peters</span>

<span class="n">Beautiful</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">ugly</span><span class="o">.</span>
<span class="n">Explicit</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">implicit</span><span class="o">.</span>
<span class="n">Simple</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="nb">complex</span><span class="o">.</span>
<span class="n">Complex</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">complicated</span><span class="o">.</span>
<span class="n">Flat</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">nested</span><span class="o">.</span>
<span class="n">Sparse</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">dense</span><span class="o">.</span>
<span class="n">Readability</span> <span class="n">counts</span><span class="o">.</span>
<span class="n">Special</span> <span class="n">cases</span> <span class="n">aren</span><span class="s">&#39;t special enough to break the rules.</span>
<span class="n">Although</span> <span class="n">practicality</span> <span class="n">beats</span> <span class="n">purity</span><span class="o">.</span>
<span class="n">Errors</span> <span class="n">should</span> <span class="n">never</span> <span class="k">pass</span> <span class="n">silently</span><span class="o">.</span>
<span class="n">Unless</span> <span class="n">explicitly</span> <span class="n">silenced</span><span class="o">.</span>
<span class="n">In</span> <span class="n">the</span> <span class="n">face</span> <span class="n">of</span> <span class="n">ambiguity</span><span class="p">,</span> <span class="n">refuse</span> <span class="n">the</span> <span class="n">temptation</span> <span class="n">to</span> <span class="n">guess</span><span class="o">.</span>
<span class="n">There</span> <span class="n">should</span> <span class="n">be</span> <span class="n">one</span><span class="o">--</span> <span class="ow">and</span> <span class="n">preferably</span> <span class="n">only</span> <span class="n">one</span> <span class="o">--</span><span class="n">obvious</span> <span class="n">way</span> <span class="n">to</span> <span class="n">do</span> <span class="n">it</span><span class="o">.</span>
<span class="n">Although</span> <span class="n">that</span> <span class="n">way</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">obvious</span> <span class="n">at</span> <span class="n">first</span> <span class="n">unless</span> <span class="n">you</span><span class="s">&#39;re Dutch.</span>
<span class="n">Now</span> <span class="ow">is</span> <span class="n">better</span> <span class="n">than</span> <span class="n">never</span><span class="o">.</span>
<span class="n">Although</span> <span class="n">never</span> <span class="ow">is</span> <span class="n">often</span> <span class="n">better</span> <span class="n">than</span> <span class="o">*</span><span class="n">right</span><span class="o">*</span> <span class="n">now</span><span class="o">.</span>
<span class="n">If</span> <span class="n">the</span> <span class="n">implementation</span> <span class="ow">is</span> <span class="n">hard</span> <span class="n">to</span> <span class="n">explain</span><span class="p">,</span> <span class="n">it</span><span class="s">&#39;s a bad idea.</span>
<span class="n">If</span> <span class="n">the</span> <span class="n">implementation</span> <span class="ow">is</span> <span class="n">easy</span> <span class="n">to</span> <span class="n">explain</span><span class="p">,</span> <span class="n">it</span> <span class="n">may</span> <span class="n">be</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span><span class="o">.</span>
<span class="n">Namespaces</span> <span class="n">are</span> <span class="n">one</span> <span class="n">honking</span> <span class="n">great</span> <span class="n">idea</span> <span class="o">--</span> <span class="n">let</span><span class="s">&#39;s do more of those!</span>
</pre></div>


<h2>PEP 8</h2>
<h3>Whitespace</h3>
<ul>
<li>4 spaces, no tabs.</li>
<li>One blank line between functions.</li>
<li>Two blank line between classes.</li>
<li>Add a space after "," in dicts, lists, tuples, and argument lists; and after ":" in dicts, but not before.</li>
<li>Put spaces around assignments and comparisons (except in argument lists).</li>
<li>No spaces just inside parentheses or just before argument lists.</li>
<li>No spaces just inside docstrings.</li>
</ul>
<h3>Naming</h3>
<ul>
<li><code>joined_lower</code> for functions, methods, attributes</li>
<li><code>joined_lower</code> or <code>ALL_CAPS</code> for constants</li>
<li><code>CamelCase</code> for classes</li>
<li>Attributes: <code>interface</code>, <code>_internal</code>, (and <em>try to avoid</em> <code>__private</code>)</li>
</ul>
<h3>Docstrings and Comments</h3>
<ul>
<li>Docstrings = <strong>How to use</strong> code<ul>
<li>Useful in interactive use (<code>help()</code>) and for auto-documentation systems.</li>
</ul>
</li>
<li>Comments = <strong>Why</strong> (rationale) and <strong>how code words</strong><ul>
<li>!!! BUG: ...</li>
<li>!!! FIX: This is a hack</li>
<li>??? Why is this here</li>
</ul>
</li>
</ul>
<h3>Practicality Beats Purity</h3>
<p>Two good reasons to break a particular rule:</p>
<ul>
<li>When applying the rule would make the code less readable.</li>
<li>To be consistent with surrounding code that also breaks it.</li>
</ul>
<p>... but practicality shouldn't beat purity to a pulp!</p>
<h2>Idiom Potpourri</h2>
<h3>Swap values</h3>
<blockquote>
<p><code>python
b, a = a, b</code></p>
</blockquote>
<h3>Interactive "_" Reuse last expression</h3>
<ul>
<li>In the interactive Interpreter, <code>_</code> stores last <em>printed</em> expressions.</li>
</ul>
<blockquote>
<p>```python</p>
<blockquote>
<blockquote>
<blockquote>
<p>1 + 1
2
_
2
```</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3>Building Strings from Substrings</h3>
<ul>
<li>Use <code>str.join()</code> method</li>
<li>Build a nicely grammatical sentence.</li>
</ul>
<blockquote>
<p>```python</p>
<blockquote>
<blockquote>
<blockquote>
<p>colors = ['red', 'blue', 'green', 'yellow']
print('Choose', ', '.join(colors[:-1]), \ 'or', colors[-1])
Choose red, blue, green or yellow
```</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3>Use <code>in</code> where possible</h3>
<ul>
<li><code>in</code> is generally faster.</li>
</ul>
<blockquote>
<p><code>python
for key in d:
    print(key)</code></p>
</blockquote>
<ul>
<li>Use <code>key in dict</code>, not <code>dict.has_key()</code>.</li>
</ul>
<blockquote>
<p>```python</p>
<h1>do this:</h1>
<p>if key in dic:
    do_sth(d[key])</p>
<h1>not this:</h1>
<p>if dic.has_key(key):
    do_sth(d[key])
```</p>
</blockquote>
<h3>Dictionary</h3>
<h4><code>get</code> Method</h4>
<ul>
<li>Use <code>dict.get(key, default)</code> to initialize dictionary entries before use.</li>
</ul>
<blockquote>
<p><code>python
dic = {}
for (key, val) in data:
    dic[key] = dic.get(key, 0) + val</code></p>
</blockquote>
<h4><code>setdefault</code> Method</h4>
<ul>
<li>Use <code>dict.setdefault(key, default)</code> to initialize dictionary values.<ul>
<li>Pro: more efficient if key is expensive to compute.</li>
<li>Con: default value always evaluated (could be expensive).</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>python
for (key, val) in data:
    dic.setdefault(key, []).append(val)</code></p>
</blockquote>
<h4><code>defaultdict</code> Class</h4>
<ul>
<li>Use <code>collections.defaultdict</code> classes<ul>
<li>it takes a default factory function;</li>
<li>the factory function is called to initialize the value when a key is first encountered.</li>
<li>Use <code>key in dict</code> to check for a key, (you may not get <code>KeyError</code> exceptions as you wish.)</li>
</ul>
</li>
</ul>
<blockquote>
<p>```python
from collections import defaultdict</p>
<p>equities = defaultdict(list)
for (portfolio, equity) in data:
    equities[portfolio].append(equity)</p>
<p>dic = defaultdict(int)
for (key, val1, val2) in data:
    navs[key] += val1 * val2
```</p>
</blockquote>
<h4>Building Dictionaries</h4>
<ul>
<li>Use <code>zip</code> to build a dict from two lists.<ul>
<li>size of dict equals shorter list</li>
<li>the orders of <code>dict.keys()</code> and <code>dict.values()</code> may be <strong>different</strong> from original, but will <strong>correspond</strong> each other.</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>python
dic = dict(zip(keys, values))</code></p>
</blockquote>
<h3>Truth Values</h3>
<ul>
<li>False: <code>False</code>, <code>''</code> (empty str), <code>0</code>, <code>0.0</code>, <code>[]</code>, <code>()</code>, <code>{}</code>, <code>set()</code>, <code>None</code></li>
<li>True: almost any object that's not explicitly False</li>
</ul>
<blockquote>
<p>```python</p>
<h1>do this</h1>
<p>if x: pass
if items: pass</p>
<h1>not this:</h1>
<p>if x == True: pass
if len(items) != 0: pass
if items != []: pass
```</p>
</blockquote>
<ul>
<li>To control the truth value of instances of a user-defined class, use the <code>__nonzero__</code>, <code>__bool__</code> or <code>__len__</code> special methods. <ul>
<li>Use <code>__len__</code> if your class is a container which has a length.</li>
<li>If your class is not a container, use <code>__nonzero__</code>.</li>
<li>In Python 3.0, <code>__nonzero__</code> has been renamed to <code>__bool__</code> for consistency with the <code>bool</code> built-in type. For compatibility, add this to the class definition: <code>__bool__ = __nonzero__</code>.</li>
</ul>
</li>
</ul>
<h3>Index and Item</h3>
<ul>
<li>The <code>enumerate</code> function takes a list and returns a <em>generator</em> containing <code>(index, item)</code> pairs.</li>
</ul>
<blockquote>
<p><code>python
for (index, item) in enumerate(items):
    print index, item</code></p>
</blockquote>
<h3>Variables Are Just Tags</h3>
<ul>
<li>Python has "names"<ul>
<li>In many other languages, assigning to a variable puts a value into a box.</li>
<li>In Python, a "name" or "identifier" is like a parcel tag (or nametag) attached to an object.</li>
</ul>
</li>
</ul>
<h3>Default Parameter Values</h3>
<ul>
<li>Default parameter values better use <code>None</code></li>
</ul>
<blockquote>
<p>```python</p>
<blockquote>
<blockquote>
<blockquote>
<p>def bad_append(new_item, a_list=[]):
...     a_list.append(new_item)
...     return a_list
print bad_append('one')
['one']
print bad_append('two')
['one', 'two']
```</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3>List Comprehensions</h3>
<blockquote>
<p><code>python
new_list = [func(item) for item in old_list if condition(item)]</code></p>
</blockquote>
<h3>Generators</h3>
<ul>
<li>Use a <strong>generator expression</strong> when the computed list is just an <em>intermediate step</em>.</li>
<li>Use a <strong>list comprehension</strong> when a computed list is the desired <em>end result</em>.</li>
</ul>
<blockquote>
<p><code>python
sq = [n*n for n in range(100)]
s_sq = sum(n*n for n in range(100))</code></p>
</blockquote>
<h3>Sorting</h3>
<ul>
<li>The in-place <code>sort</code> method</li>
</ul>
<blockquote>
<p>```python
a_list.sort()</p>
<p>def my_key(item):
    return (item[1], item[3])</p>
<p>a_list.sort(key=my_key)
```</p>
</blockquote>
<h3><code>for</code> Loop</h3>
<ol>
<li>Python lools at the sequence after <code>in</code>.<ul>
<li>If it is a simple container (i.e. list, tuple, etc), Python converts it into an <em>iterator</em>.</li>
<li>If it is already an iterator, Python uses it directly.</li>
</ul>
</li>
<li>Python repeatedly calls iterator's <code>next</code> method, assigns the return value to loop counter (<code>item</code> in this case), and executes the indented codes.</li>
<li>This repeats over and over, until <code>StopIteration</code> is raised, or a <code>break</code> statement is executed in the code.</li>
<li>A <code>for</code> loop can have an <code>else</code> clause, whose code is executed <strong>after</strong> the iterator runs dry, but <strong>not</strong> after a <code>break</code> statement is executed.</li>
</ol>
<blockquote>
<p><code>python
for item in sequence:
    if condition(item):
        break
else:
    raise Exception('Condition not satisfied by any item in sequence.')</code></p>
</blockquote>
<h3>EAFP vs LBYL</h3>
<ul>
<li>It's easier to ask forgiveness than permission.</li>
<li>Look before you leap</li>
<li>Generally EAFP is preferred, but not always.<ul>
<li>Exceptions: Use coercion if an object must be a particular type. If <code>x</code> must be a string for your code to work, why not call <code>str(x)</code> instead of trying something like <code>isinstance(x, str)</code>.</li>
</ul>
</li>
</ul>
<h3>EAFP <code>try/except</code> Example</h3>
<ul>
<li>You can wrap exception-prone code in a <code>try/except</code> block to catch the errors, and you will probably end up with a solution that's much more general than if you had tried to anticipate every possibility.</li>
<li>Note: Always specify the exceptions to catch. Never use bare <code>except</code> clauses. Bare <code>except</code> clauses will catch unexpected exceptions, making your code exceedingly difficult to debug.</li>
</ul>
<blockquote>
<p><code>python
try:
    return str(x)
except TypeError:
    ...</code></p>
</blockquote>
<h3>Import</h3>
<ul>
<li><strong>DO NOT</strong> wild-card importing</li>
</ul>
<blockquote>
<p>```python</p>
<h1>NEVER DO THIS!!!</h1>
<p>from module import *</p>
<h1>Do this</h1>
<p>import module
module.name</p>
<p>import long_module_name as mod
mod.name</p>
<p>from module import name
name
```</p>
</blockquote>
<h3>Modules and Packages</h3>
<h4>Hide Top-Level Codes</h4>
<ul>
<li>Better not to put any major executable code at the top-level. Put code in functions, classes, methods, and guard it with <code>if __name__ == '__main__'</code>.</li>
</ul>
<blockquote>
<p><code>python
if __name__ == '__main__':
    # script code here</code></p>
</blockquote>
<h4>Module Structures</h4>
<ul>
<li>This is how a module should be structured.</li>
</ul>
<blockquote>
<p>```python
"""module docstring"""</p>
<h1>imports</h1>
<h1>constants</h1>
<h1>exception classes</h1>
<h1>interface functions</h1>
<h1>classes</h1>
<h1>internal functions &amp; classes</h1>
<p>def main(...):
    ...</p>
<p>if <strong>name</strong> == '<strong>main</strong>':
    status = main()
    sys.exit(status)
```</p>
</blockquote>
<ul>
<li>A more complicated example: command-line processing</li>
</ul>
<blockquote>
<p>```python</p>
<h1>!/usr/bin/env python</h1>
<p>"""
Module docstring.
"""</p>
<p>import sys
import optparse</p>
<p>def process_command_line(argv):
    """
    Return a 2-tuple: (settings object, args list).
    <code>argv</code> is a list of arguments, or <code>None</code> for <code>sys.argv[1:]</code>.
    """
    if argv is None:
        argv = sys.argv[1:]</p>
<div class="highlight"><pre># initialize the parser object:
parser = optparse.OptionParser(
    formatter=optparse.TitledHelpFormatter(width=78),
    add_help_option=None)

# define options here:
parser.add_option(      # customized description; put --help last
    &#39;-h&#39;, &#39;--help&#39;, action=&#39;help&#39;,
    help=&#39;Show this help message and exit.&#39;)

settings, args = parser.parse_args(argv)

# check number of arguments, verify values, etc.:
if args:
    parser.error(&#39;program takes no command-line arguments; &#39;
                 &#39;&quot;%s&quot; ignored.&#39; % (args,))

# further process settings &amp; args if necessary

return settings, args
</pre></div>


<p>def main(argv=None):
    settings, args = process_command_line(argv)
    # application code here, like:
    # run(settings, args)
    return 0        # success</p>
<p>if <strong>name</strong> == '<strong>main</strong>':
    status = main()
    sys.exit(status)
```</p>
</blockquote>
<h4>Packages structures.</h4>
<ul>
<li>Used to organize your project.</li>
<li>Reduces entries in load-path.</li>
<li>Reduces import name conflicts.</li>
</ul>
<blockquote>
<p>```
package/
    <strong>init</strong>.py
  module1.py
  subpackage/
      <strong>init</strong>.py
      module2.py</p>
<p>import package.module1
from package.subpackage import module2
from package.subpackage.module2 import name
```</p>
</blockquote>
<h3>Simple is Better Than Complex</h3>
<h3>Don't reinvent the wheel</h3>
<p>Before writing any code,</p>
<ul>
<li>Check Python's standard library.</li>
<li>Check "PyPI - the Python Package Index": <a href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a></li>
<li>Search the web.</li>
</ul>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/feigaochn">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>